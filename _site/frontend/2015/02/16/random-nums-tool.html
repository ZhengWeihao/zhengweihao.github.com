<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="shortcut icon" href="/imgs/fav.ico">
    <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->
    <title>JQuery+HTML实现年会摇奖小工具</title>
    <meta name="description" content="">
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
    </style>
  </head>
  <body>
    <aside id="sidebar">
      <nav id="tags">
        <a href="/index.html" id="avatar"></a>

        <ul id="tags__ul">
          <li id="js-label1" class="tags__li tags-btn active">All Posts</li>
          <li id="js-label2" class="tags__li tags-btn">Java相关</li>
          <li id="js-label3" class="tags__li tags-btn">摄影相关</li>
        </ul>

        <div id="tags__bottom">
          <a href="mailto:place_your_email_address_here" id="icon-email" class="tags-btn fontello"></a>
          <a href="/rss.xml" id="icon-feed" class="tags-btn fontello"></a>
        </div>
      </nav> <!-- end #tags -->

      <div id="posts-list">
        <form action="" id="search-form">
          <a href="/index.html" id="mobile-avatar"></a>
          <!-- NOTE: input field is disabled by default -->
          <input id="search-input" type="text" placeholder="Search..." disabled >
        </form>

        <nav id="pl__container">
        
          <a class="photo style color pl__all" href="/photo/style/color/2018/01/22/photo-styles-colors.html"><span class="pl__circle"></span><span class="pl__title">常见照片风格总结</span><span class="pl__date">Jan 2018</span></a>
        
          <a class="java jvm pl__all" href="/java/jvm/2018/01/22/java-jvm.markdown.html"><span class="pl__circle"></span><span class="pl__title">JVM笔记</span><span class="pl__date">Jan 2018</span></a>
        
          <a class="java pl__all" href="/java/2018/01/22/java-common.html"><span class="pl__circle"></span><span class="pl__title">Java常用操作笔记</span><span class="pl__date">Jan 2018</span></a>
        
          <a class="java concurrent pl__all" href="/java/concurrent/2016/07/12/java-concurrent.html"><span class="pl__circle"></span><span class="pl__title">Java并发编程笔记</span><span class="pl__date">Jul 2016</span></a>
        
          <a class="osx system pl__all" href="/osx/system/2015/10/28/osx-operates.html"><span class="pl__circle"></span><span class="pl__title">OSX常用操作笔记</span><span class="pl__date">Oct 2015</span></a>
        
          <a class="frontend cordova pl__all" href="/frontend/cordova/2015/03/20/css3-snowflake.html"><span class="pl__circle"></span><span class="pl__title">JQuery+CSS3实现雪花飘落效果</span><span class="pl__date">Mar 2015</span></a>
        
          <a class="frontend cordova pl__all" href="/frontend/cordova/2015/03/20/cordova-first.html"><span class="pl__circle"></span><span class="pl__title">Cordova开发笔记</span><span class="pl__date">Mar 2015</span></a>
        
          <a class="backend java spring springMVC pl__all" href="/backend/java/spring/springmvc/2015/02/16/spring-mvc-freemark.html"><span class="pl__circle"></span><span class="pl__title">SpringMVC集成Freemark及JSON格式输出</span><span class="pl__date">Feb 2015</span></a>
        
          <a class="frontend pl__all" href="/frontend/2015/02/16/random-nums-tool.html"><span class="pl__circle"></span><span class="pl__title">JQuery+HTML实现年会摇奖小工具</span><span class="pl__date">Feb 2015</span></a>
        
        </nav>
      </div> <!-- end #posts-list -->
    </aside> <!-- end #sidebar -->

    <div id="post">
      <div id="pjax">
        <h2 id="jqueryhtml实现年会摇奖小工具">JQuery+HTML实现年会摇奖小工具</h2>

<ul>
  <li>
    <p>背景：</p>

    <p>　　因公司年会抽奖需要而编写网页版的此工具。使用流程为：由工作人员为员工们发配个人编号（连续数字），然后在工具中设置抽奖编号区间，之后点击“摇奖”按钮进行摇号，点击“停止”按钮后，确认一个区间内数字，即为中奖号，而该号对应编号的同事即为中奖人了。</p>
  </li>
  <li>
    <p>实现思路：</p>

    <p>　　首先定义两个数组：一为<code>号码数组</code>，将摇号的所有数字打乱次序后，放入其中；另外一个则是<code>中奖数组</code>，将中奖号码从号码数组中删去，存入到中奖数组中。</p>

    <p>　　定义好数组变量后，还需要一个<code>标志变量</code>，作为摇奖进行中与停止的标志。编写一个主函数，定时地进行执行，根据旗帜变量进行相应的操作：在摇奖过程中时，将号码数组的所有数字依依快速地显示到显示框中；在停止后，选定当时显示的数字作为中奖数字，并停止定时执行。实现如下:    　　</p>

    <pre><code>  //主函数
  var range = [];//号码数组
  var prize = [];//中奖数组
  var inGame = false;//旗帜变量
  var exe_i = 0;//当前执行到的下标
  function main() {
      if(inGame) {//继续执行
          //操作数组下标
          exe_i++;
          if(exe_i &gt;= range.length) exe_i = 0;
    
          //显示数组内容
          $stage.html(range[exe_i]);
    
          //数组长度不够时自动结束
          if(range.length &lt;= 1) inGame = false;
      } else {//结束游戏
          var cur = range[exe_i];//当前号码
    
          //更新数组数据
          prize.push(cur);
          range.splice(exe_i, 1);
    
          //显示结果
          console.log('下标:' + exe_i + ';数字:' + cur);
          alert('摇中号码：' + cur);
          msg();
    
          //停止定时任务
          window.clearInterval(mainInterval);
      }
  }
</code></pre>

    <p>　　有了主函数，工具已经完成了一大半，现在还需要一个触发的函数作为开始与停止操作的触发者。点击“开始”按钮时修改状态位为开始状态并开始定时执行主函数，而点击“停止”按钮时修改旗帜变量状态位为停止状态，主函数会根据状态为进入到停止操作。实现如下：</p>

    <pre><code>  //触发函数
  var mainInterval;//定时执行任务标识，通过它可以取消定时执行
  function play() {
      if(inGame) {//执行时触发 -&gt; 停止
          inGame = false;
      } else {//非执行状态触发 -&gt; 开始
          //检查执行环境
          if(range.length &lt;= 0) {
              alert('没号了，加几个进来呗');
              return;
          }
            
          //开始执行
          inGame = true;
          mainInterval = self.setInterval('main()', 50);
      }
  }
</code></pre>

    <p>　　至此核心部分已经基本完成，当然还缺少一些细节的控制，比如：需要提供输入框进行交互；需要根据输入区间产生乱序的号码数组等，这里就不再赘述了，当然，最后还需要对界面美化一下~</p>
  </li>
  <li>
    <p>结果展示：</p>

    <p>这里再提供一下最终完成的作品（背景图是人事MM找来的，原来丑得惨不忍睹。。。），<a href="/example/random-nums/index.html">点我查看</a>，详细代码就请点<code>审查元素</code>咯 ^_^</p>
  </li>
</ul>

      </div> <!-- end #pjax -->

      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">Table of Contents</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div>
    </div> <!-- end #post -->

    <button id="js-fullscreen"><span id="icon-arrow" class="fontello"></span></button>

    <script src="/assets/js/jquery-2.0.3.min.js"></script>
    <script src="/assets/js/jquery.pjax.js"></script>
    <script src="/assets/js/nprogress.js"></script>
    <script src="/assets/js/script.js"></script>

    <!-- UpYun Advertise
    <div class="adv">
    	<a href="http://www.upyun.com/">
    		<img src="/imgs/upyun_logo.png" />
    	</a>
    </div> -->
  </body>
</html>