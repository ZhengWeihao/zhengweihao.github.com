<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="shortcut icon" href="/imgs/fav.ico">
    <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->
    <title>SpringMVC集成Freemark及JSON格式输出</title>
    <meta name="description" content="">
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
    </style>
  </head>
  <body>
    <aside id="sidebar">
      <nav id="tags">
        <a href="/index.html" id="avatar"></a>

        <ul id="tags__ul">
          <li id="js-label1" class="tags__li tags-btn active">All Posts</li>
          <li id="js-label2" class="tags__li tags-btn">Java相关</li>
          <li id="js-label3" class="tags__li tags-btn">摄影相关</li>
        </ul>

        <div id="tags__bottom">
          <a href="mailto:place_your_email_address_here" id="icon-email" class="tags-btn fontello"></a>
          <a href="/rss.xml" id="icon-feed" class="tags-btn fontello"></a>
        </div>
      </nav> <!-- end #tags -->

      <div id="posts-list">
        <form action="" id="search-form">
          <a href="/index.html" id="mobile-avatar"></a>
          <!-- NOTE: input field is disabled by default -->
          <input id="search-input" type="text" placeholder="Search..." disabled >
        </form>

        <nav id="pl__container">
        
          <a class="photo style color pl__all" href="/photo/style/color/2018/01/22/photo-styles-colors.html"><span class="pl__circle"></span><span class="pl__title">常见照片风格总结</span><span class="pl__date">Jan 2018</span></a>
        
          <a class="java jvm pl__all" href="/java/jvm/2018/01/22/java-jvm.markdown.html"><span class="pl__circle"></span><span class="pl__title">JVM笔记</span><span class="pl__date">Jan 2018</span></a>
        
          <a class="java pl__all" href="/java/2018/01/22/java-common.html"><span class="pl__circle"></span><span class="pl__title">Java常用操作笔记</span><span class="pl__date">Jan 2018</span></a>
        
          <a class="java concurrent pl__all" href="/java/concurrent/2016/07/12/java-concurrent.html"><span class="pl__circle"></span><span class="pl__title">Java并发编程笔记</span><span class="pl__date">Jul 2016</span></a>
        
          <a class="osx system pl__all" href="/osx/system/2015/10/28/osx-operates.html"><span class="pl__circle"></span><span class="pl__title">OSX常用操作笔记</span><span class="pl__date">Oct 2015</span></a>
        
          <a class="frontend cordova pl__all" href="/frontend/cordova/2015/03/20/css3-snowflake.html"><span class="pl__circle"></span><span class="pl__title">JQuery+CSS3实现雪花飘落效果</span><span class="pl__date">Mar 2015</span></a>
        
          <a class="frontend cordova pl__all" href="/frontend/cordova/2015/03/20/cordova-first.html"><span class="pl__circle"></span><span class="pl__title">Cordova开发笔记</span><span class="pl__date">Mar 2015</span></a>
        
          <a class="backend java spring springMVC pl__all" href="/backend/java/spring/springmvc/2015/02/16/spring-mvc-freemark.html"><span class="pl__circle"></span><span class="pl__title">SpringMVC集成Freemark及JSON格式输出</span><span class="pl__date">Feb 2015</span></a>
        
          <a class="frontend pl__all" href="/frontend/2015/02/16/random-nums-tool.html"><span class="pl__circle"></span><span class="pl__title">JQuery+HTML实现年会摇奖小工具</span><span class="pl__date">Feb 2015</span></a>
        
        </nav>
      </div> <!-- end #posts-list -->
    </aside> <!-- end #sidebar -->

    <div id="post">
      <div id="pjax">
        <h2 id="springmvc集成freemark及json格式输出">SpringMVC集成Freemark及JSON格式输出</h2>
<blockquote>
  <p>最近做项目需要使用SpringMVC代替Struts2，因此进行了对SpringMVC的一些初步学习，而在以前的项目中，也是对Freemark比较熟悉，所以也做了整合Freemark的一些工作，在这里做个记录。</p>
</blockquote>

<h3 id="第一部分springmvc基本配置">第一部分：SpringMVC基本配置</h3>

<ul>
  <li>
    <p>Jar包：</p>

    <p>项目为Maven工程，所以使用pom文件管理jar包，具体依赖如下：</p>

    <pre><code>  &lt;!--spring 依赖 --&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
    &lt;version&gt;3.1.0.RELEASE&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;3.1.0.RELEASE&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
    &lt;version&gt;3.1.0.RELEASE&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
    &lt;version&gt;3.1.0.RELEASE&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;
    &lt;version&gt;${spring.version}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
    &lt;version&gt;3.1.0.RELEASE&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
    &lt;version&gt;${spring.version}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;
    &lt;version&gt;${spring.version}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-orm&lt;/artifactId&gt;
    &lt;version&gt;${spring.version}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
    &lt;version&gt;${spring.version}&lt;/version&gt;
  &lt;/dependency&gt;

  &lt;!-- Freemarker --&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.freemarker&lt;/groupId&gt;
    &lt;artifactId&gt;freemarker&lt;/artifactId&gt;
    &lt;version&gt;2.3.20&lt;/version&gt;
  &lt;/dependency&gt;
</code></pre>
  </li>
  <li>
    <p>Spring支持与SpringMVC基本配置：</p>

    <p>１、Spring基本配置，在Web.xml中添加相应地监听器，并指定配置文件（记得建立配置文件，否则会报FileNotFound异常），如下：</p>

    <pre><code>  &lt;!-- Spring 上下文配置文件 --&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;
  &lt;/context-param&gt;

  &lt;!-- Spring 刷新Introspector防止内存泄露 --&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;
      org.springframework.web.util.IntrospectorCleanupListener
    &lt;/listener-class&gt;
  &lt;/listener&gt;

  &lt;!-- Spring 使用ContextLoaderListener加载ApplicationContext配置信息 --&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
  &lt;/listener&gt;
</code></pre>

    <p>２、SpringMVC配置(Web.xml中配置，并建立spring-mvc.xml配置文件）。
  在web.xml中添加DispatcherServlet的设定，并设置url-pattern为要捕获的路径规则（也可设置成类似*.action的格式），如下：</p>

    <pre><code>  &lt;!-- Spring MVC --&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;springDispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;springDispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
</code></pre>

    <p>在spring-mvc.xml中配置页面返回规则，并指定Spring自动扫描的路径，如下：</p>

    <pre><code>  &lt;!-- Spring MVC UrlMapping --&gt;
      &lt;!-- Spring MVC UrlMapping --&gt;
  &lt;bean id="urlMapping"
    class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping" /&gt;
  &lt;bean
    class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"&gt;
    &lt;property name="messageConverters"&gt;
      &lt;list&gt;
        &lt;bean id="mappingStringHttpMessageConverter" class="org.springframework.http.converter.StringHttpMessageConverter"&gt;
          &lt;property name="supportedMediaTypes"&gt;
            &lt;list&gt;
              &lt;bean class="org.springframework.http.MediaType"&gt;
                &lt;constructor-arg index="0" value="text" /&gt;
                &lt;constructor-arg index="1" value="plain" /&gt;
                &lt;constructor-arg index="2" value="UTF-8" /&gt;
              &lt;/bean&gt;
            &lt;/list&gt;
            &lt;!-- &lt;list&gt;  
                      &lt;value&gt;text/plain;charset=UTF-8&lt;/value&gt;  
                      &lt;value&gt;text/html;charset=UTF-8&lt;/value&gt;  
                  &lt;/list&gt; --&gt;
          &lt;/property&gt;
        &lt;/bean&gt;
      &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
    
  &lt;!-- 自动扫描转化 标有@Controller注解的类为bean --&gt;
  &lt;context:component-scan base-package="com.test" /&gt;
</code></pre>

    <p>３、编写控制器，以供测试，控制器代码如下：</p>

    <pre><code>  @Controller
  public class TestController {
  
    @RequestMapping("/test_index")
    public ModelAndView index(HttpServletRequest req) {
      ModelAndView mav = new ModelAndView("index");
      mav.addObject("pix", pix);
      return mav;
    }
  }
</code></pre>
  </li>
</ul>

<h3 id="第二部分springmvc集成freemark输出模板页面">第二部分：SpringMVC集成Freemark输出模板页面</h3>

<ul>
  <li>
    <p>添加Freemark的pom依赖，如下：
  ​<br />
    <!-- Freemarker -->
    <dependency>
      <groupId>org.freemarker</groupId>
      <artifactId>freemarker</artifactId>
      <version>2.3.20</version>
    </dependency></p>
  </li>
  <li>
    <p>在spring-mvc.xml中设置使用Freemark为视图解析器，如下：</p>

    <pre><code>&lt;!-- FreeMarker基础支持 --&gt;  
&lt;bean id="freemarkerConfigurer" class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"&gt;  
    &lt;property name="templateLoaderPath" value="/view/" /&gt;
    &lt;property name="defaultEncoding" value="UTF-8" /&gt;
    &lt;property name="freemarkerSettings"&gt;
        &lt;props&gt;
            &lt;prop key="template_update_delay"&gt;10&lt;/prop&gt;
            &lt;prop key="locale"&gt;zh_CN&lt;/prop&gt;
            &lt;prop key="datetime_format"&gt;yyyy-MM-dd HH:mm:ss&lt;/prop&gt;
            &lt;prop key="date_format"&gt;yyyy-MM-dd&lt;/prop&gt;
            &lt;prop key="number_format"&gt;#.##&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;
&lt;!-- FreeMarker视图解析 --&gt;
&lt;bean id="viewResolver" class="org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver"&gt;  
    &lt;property name="viewClass" value="org.springframework.web.servlet.view.freemarker.FreeMarkerView" /&gt;
    &lt;property name="suffix" value=".ftl" /&gt;
    &lt;property name="contentType" value="text/html;charset=UTF-8" /&gt;
    &lt;property name="exposeRequestAttributes" value="true" /&gt;
    &lt;property name="exposeSessionAttributes" value="true" /&gt;
    &lt;property name="exposeSpringMacroHelpers" value="true" /&gt;
&lt;/bean&gt;
</code></pre>
  </li>
  <li>
    <p>控制器中进行测试</p>

    <pre><code>@RequestMapping("/test_ftl")
public ModelAndView index(HttpServletRequest req) {
  String pix = req.getParameter("pix");

  ModelAndView mav = new ModelAndView("index");
  mav.addObject("pix", pix);
  return mav;
}
</code></pre>
  </li>
</ul>

<h3 id="第三部分配置springmvc输出json格式的数据">第三部分：配置SpringMVC输出JSON格式的数据</h3>

<ul>
  <li>
    <p>在pom文件中添加对Jackson的依赖，如下：</p>

    <pre><code>&lt;!-- JSON for Spring MVC --&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;
&lt;artifactId&gt;jackson-core-asl&lt;/artifactId&gt;
&lt;version&gt;1.8.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;
&lt;artifactId&gt;jackson-mapper-asl&lt;/artifactId&gt;
&lt;version&gt;1.9.7&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;
&lt;artifactId&gt;jackson-jaxrs&lt;/artifactId&gt;
&lt;version&gt;1.8.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;
&lt;artifactId&gt;jackson-xc&lt;/artifactId&gt;
&lt;version&gt;1.8.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
  </li>
  <li>
    <p>在spring-mvc.xml中配置JSON格式的支持，如下：</p>

    <pre><code>&lt;!-- Spring MVC JSON输出格式 --&gt;
&lt;bean id="mappingJacksonHttpMessageConverter" class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter"&gt;
  &lt;property name="supportedMediaTypes"&gt;
    &lt;list&gt;
      &lt;value&gt;application/json;charset=UTF-8&lt;/value&gt;
      &lt;value&gt;text/html;charset=UTF-8&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;
</code></pre>

    <p>并将Jackson的实体引入到AnnotationMethodHandlerAdapter类的messageConverters属性当中，如下：</p>

    <pre><code>&lt;bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"&gt;
  &lt;property name="messageConverters"&gt;
    &lt;list&gt;
      &lt;!-- JSON文本输出格式 --&gt;
      &lt;ref bean="mappingJacksonHttpMessageConverter" /&gt;
      &lt;!-- 简单文本输出格式 --&gt;
      &lt;ref bean="mappingStringHttpMessageConverter" /&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
  </li>
  <li>
    <p>在控制器中编写JSON格式测试方法，如下：</p>

    <pre><code>@RequestMapping("/test_json")
@ResponseBody
public JSONObject testJson(Long id, String name) {
  JSONObject obj = new JSONObject();
  obj.put("id", id);
  obj.put("name", name);
  return obj;
}
</code></pre>
  </li>
</ul>


      </div> <!-- end #pjax -->

      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">Table of Contents</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div>
    </div> <!-- end #post -->

    <button id="js-fullscreen"><span id="icon-arrow" class="fontello"></span></button>

    <script src="/assets/js/jquery-2.0.3.min.js"></script>
    <script src="/assets/js/jquery.pjax.js"></script>
    <script src="/assets/js/nprogress.js"></script>
    <script src="/assets/js/script.js"></script>

    <!-- UpYun Advertise
    <div class="adv">
    	<a href="http://www.upyun.com/">
    		<img src="/imgs/upyun_logo.png" />
    	</a>
    </div> -->
  </body>
</html>